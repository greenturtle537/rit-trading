# RIT Trading - Apache2 Virtual Host Configuration
# This configuration serves the frontend and proxies API requests to the Perl backend

<VirtualHost *:80>
    ServerName rit-trading.local
    ServerAlias www.rit-trading.local
    
    # Server admin email
    ServerAdmin admin@rit-trading.local
    
    # Document root - serves frontend static files
    DocumentRoot /var/www/rit-trading/frontend
    
    # Frontend directory configuration
    <Directory /var/www/rit-trading/frontend>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
        
        # Enable .html extension removal (optional)
        # RewriteEngine On
        # RewriteCond %{REQUEST_FILENAME} !-f
        # RewriteCond %{REQUEST_FILENAME}.html -f
        # RewriteRule ^(.*)$ $1.html [L]
    </Directory>
    
    # Reverse proxy for API requests to Perl backend
    # Forwards /api/* to http://localhost:3000/api/*
    ProxyPreserveHost On
    ProxyPass /api http://localhost:3000/api
    ProxyPassReverse /api http://localhost:3000/api
    
    # Optional: Proxy timeout settings
    ProxyTimeout 300
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/rit-trading-error.log
    CustomLog ${APACHE_LOG_DIR}/rit-trading-access.log combined
    
    # Optional: Compression for static files
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>
    
    # Optional: Browser caching for static assets
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/png "access plus 1 month"
        ExpiresByType text/css "access plus 1 week"
        ExpiresByType application/javascript "access plus 1 week"
    </IfModule>
</VirtualHost>

# Optional: HTTPS configuration (uncomment and configure SSL certificates)
# <VirtualHost *:443>
#     ServerName rit-trading.local
#     ServerAlias www.rit-trading.local
#     
#     ServerAdmin admin@rit-trading.local
#     DocumentRoot /var/www/rit-trading/frontend
#     
#     <Directory /var/www/rit-trading/frontend>
#         Options -Indexes +FollowSymLinks
#         AllowOverride None
#         Require all granted
#     </Directory>
#     
#     ProxyPreserveHost On
#     ProxyPass /api http://localhost:3000/api
#     ProxyPassReverse /api http://localhost:3000/api
#     
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/rit-trading.crt
#     SSLCertificateKeyFile /etc/ssl/private/rit-trading.key
#     # SSLCertificateChainFile /etc/ssl/certs/rit-trading-chain.crt
#     
#     ErrorLog ${APACHE_LOG_DIR}/rit-trading-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/rit-trading-ssl-access.log combined
# </VirtualHost>
